<?php
// ===== –ó–∞–¥–∞–Ω–∏–µ 1. –†–∞–∑–±–∏–µ–Ω–∏–µ –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –§–ò–û
// –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫—É // –ø–µ—Ä–µ–¥–∞–µ–º –≤ —Ñ—É–Ω–∫—Ü–∏—é 3 —Å—Ç—Ä–æ–∫–∏
function getFullnameFromParts($surname, $name, $patronomyc) {
	$str = "{$surname} {$name} {$patronomyc}"; // —Å–∫–ª–µ–∏–≤–∞–µ–º 3 —Å—Ç—Ä–æ–∫–∏ –≤ –æ–¥–Ω—É —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª, –∏—Å–ø–æ–ª—å–∑—É—è "" 
	return $str; // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—É—á–∏–≤—à—É—é—Å—è —Å—Ç—Ä–æ–∫—É
}

// —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –º–∞—Å—Å–∏–≤–∞ // —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É
function getPartsFromFullname($str) {
	$array1 = ['surname', 'name', 'patronomyc']; // –∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –∫–ª—é—á–∏
	$array2 = explode(' ', $str); // —Ä–∞–∑–±–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –Ω–∞ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –∏ –ø–æ–º–µ—â–∞–µ–º –∏—Ö –≤ –º–∞—Å—Å–∏–≤
	// —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤ —Å –∫–ª—é—á–∞–º–∏ –∏–∑ array1 –∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏–∑ array2
	$full_name_values = array_combine($array1, $array2);
	return $full_name_values; // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤
}

// ===== –ó–∞–¥–∞–Ω–∏–µ 2. –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –§–ò–û

function getShortName($str) { // —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É
	$arr = getPartsFromFullname($str); // –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –≤ –º–∞—Å—Å–∏–≤
	// —Å–æ–∫—Ä–∞—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª—é—á–∞ 'surname' (–ø–µ—Ä–≤–∞—è –±—É–∫–≤–∞ + .)
	$arr['surname'] = mb_substr($arr['surname'], 0, 1) . '.';
	unset($arr['patronomyc']); // —É–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞
	$arr = array_reverse($arr); // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ 
	$short_name = implode(' ', $arr); // –ø–æ–ª—É—á–∞–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞ —Å—Ç—Ä–æ–∫—É
	return $short_name; // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—É—á–∏–≤—à—É—é—Å—è —Å—Ç—Ä–æ–∫—É
}

// ===== –ó–∞–¥–∞–Ω–∏–µ 3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–∞ –ø–æ –§–ò–û

function getGenderFromName($str) { // —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É
	$arr = getPartsFromFullname($str); // –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –≤ –º–∞—Å—Å–∏–≤
	$value = 0; // –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–≤–Ω–æ 0 

	if ( // –µ—Å–ª–∏ –æ–¥–Ω–æ –∏–∑ —É—Å–ª–æ–≤–∏–π –∏—Å—Ç–∏–Ω–Ω–æ–µ
		mb_strpos($arr['surname'], '–≤–∞', -2) ||
		mb_strpos($arr['name'], 'a', -1) ||
		mb_strpos($arr['patronomyc'], '–≤–Ω–∞', -3) ||
		mb_strpos($arr['patronomyc'], '—á–Ω–∞', -3)
	) {
		$value--; // —Ç–æ —É–º–µ–Ω—å—à–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ 1
	} else if ( // –µ—Å–ª–∏ –æ–¥–Ω–æ –∏–∑ —É—Å–ª–æ–≤–∏–π –∏—Å—Ç–∏–Ω–Ω–æ–µ
		mb_strpos($arr['surname'], '–≤', -1) ||
		mb_strpos($arr['name'], '–π', -1) ||
		mb_strpos($arr['name'], '–Ω', -1) ||
		mb_strpos($arr['patronomyc'], '–∏—á', -2)
	) {
		$value++; // —Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ 1
	}
	// –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ: < 0 - –≤–µ—Ä–Ω–µ—Ç—Å—è -1, > 0 - –≤–µ—Ä–Ω–µ—Ç—Å—è 1, == 0 - –≤–µ—Ä–Ω–µ—Ç—Å—è 0
	return $value <=> 0;
}

// –ó–∞–¥–∞–Ω–∏–µ 4. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ-–ø–æ–ª–æ–≤–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞

function getGenderDescription($array) {
	/*
	// —Ç–æ–∂–µ —Å–∞–º–æ–µ –∏—Å–ø–æ–ª—å–∑—É—è foreach()
	foreach ($array as $key => $value) {
		$result = getGenderFromName($value['fullname']);
		if ($result === 1) {
			$men[] = $value;
		} else if ($result === -1) {
			$women[] = $value;
		}
	}
	*/
	// –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ —Å –º—É–∂—Å–∫–∏–º–∏ –∏–º–µ–Ω–∞–º–∏
	$men = array_filter($array, function ($array) {
		$value = getGenderFromName($array['fullname']);
		return $value === 1;
	});
	// –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ —Å –∂–µ–Ω—Å–∫–∏–º–∏ –∏–º–µ–Ω–∞–º–∏
	$women = array_filter($array, function ($array) {
		$value = getGenderFromName($array['fullname']);
		return $value === -1;
	});
	// –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ 
	$percent_of_men = count($men) / count($array) * 100; // –ø–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç –º—É–∂—Å–∫–∏—Ö –∏–º–µ–Ω
	$percent_of_men = round($percent_of_men, 1); // –æ–∫—Ä—É–≥–ª—è–µ–º
	$percent_of_women = count($women) / count($array) * 100; // –ø–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç –∂–µ–Ω—Å–∫–∏—Ö –∏–º–µ–Ω
	$percent_of_women = round($percent_of_women, 1); // –æ–∫—Ä—É–≥–ª—è–µ–º
	// –ù–ï —Å–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—Å–∏–≤ —Å –∏–º–µ–Ω–∞–º–∏, –ø–æ –∫–æ—Ç. –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª,
	// –∞ –ø—Ä–æ—Å—Ç–æ –≤—ã—á–∏—Ç–∞–µ–º –∏–∑ 100 –ø—Ä–æ—Ü–µ–Ω—Ç –º—É–∂—Å–∫–∏—Ö –∏ –ø—Ä–æ—Ü–µ–Ω—Ç –∂–µ–Ω—Å–∫–∏—Ö –∏–º–µ–Ω
	$percent_unknown_gender = 100 - $percent_of_men - $percent_of_women;
	// –≤—ã–≤–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–∫–æ–º –≤–∏–¥–µ
	$info = <<<text
	–ì–µ–Ω–¥–µ—Ä–Ω—ã–π —Å–æ—Å—Ç–∞–≤ –∞—É–¥–∏—Ç–æ—Ä–∏–∏: 
	---------------------------
	–ú—É–∂—á–∏–Ω—ã - {$percent_of_men} %
	–ñ–µ–Ω—â–∏–Ω—ã - {$percent_of_women} %
	–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å - {$percent_unknown_gender} %
	text;
	return $info; // —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ –Ω—É–∂–Ω–æ–º –Ω–∞–º –≤–∏–¥–µ
}

// –ó–∞–¥–∞–Ω–∏–µ 5. –ò–¥–µ–∞–ª—å–Ω—ã–π –ø–æ–¥–±–æ—Ä –ø–∞—Ä—ã

function getPerfectPartner($surname, $name, $patronomyc, $array) {
	$surname = trim(mb_convert_case($surname, MB_CASE_TITLE_SIMPLE)); // –º–µ–Ω—è–µ–º —Ä–µ–≥–∏—Å—Ç—Ä
	$name = trim(mb_convert_case($name, MB_CASE_TITLE_SIMPLE)); // –º–µ–Ω—è–µ–º —Ä–µ–≥–∏—Å—Ç—Ä
	$patronomyc = trim(mb_convert_case($patronomyc, MB_CASE_TITLE_SIMPLE)); // –º–µ–Ω—è–µ–º —Ä–µ–≥–∏—Å—Ç—Ä
	$current_user_name = getFullnameFromParts($surname, $name, $patronomyc); // —Å–∫–ª–µ–∏–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É
	$user_gender = getGenderFromName($current_user_name); // 1||0||-1 (–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–ª —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∏–º–µ–Ω–∏)
	if ($user_gender === 0) {
		return '–Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–∞—Ä—É :(';
	}

	$random_index = array_rand($array); // –ø–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∏–Ω–¥–µ–∫—Å –º–∞—Å—Å–∏–≤–∞
	$random_user_name = ($array[$random_index]['fullname']); // –ø–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –∏–º—è –∏–∑ –º–∞—Å—Å–∏–≤–∞
	$random_user_gender = getGenderFromName($random_user_name); // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–ª —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–º–µ–Ω–∏ –∏–∑ –º–∞—Å—Å–∏–≤–∞ 

	// –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ–ª –∏ —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ–ª –∏–∑ –º–∞—Å—Å–∏–≤–∞ —Ä–∞–≤–Ω—ã –ò–õ–ò –ø–æ–ª –∏–∑ –º–∞—Å—Å–∏–≤–∞ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å
	if ($user_gender === $random_user_gender || $random_user_gender === 0) {
		while (true) { // –∑–∞–ø—É—Å–∫–∞–µ–º –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
			$random_index = array_rand($array); // –ø–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∏–Ω–¥–µ–∫—Å –º–∞—Å—Å–∏–≤–∞
			$random_user_name = ($array[$random_index]['fullname']); // –ø–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –∏–º—è –∏–∑ –º–∞—Å—Å–∏–≤–∞
			$random_user_gender = getGenderFromName($random_user_name); // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–ª —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–º–µ–Ω–∏ –∏–∑ –º–∞—Å—Å–∏–≤–∞
			if ($user_gender !== $random_user_gender && $random_user_gender !== 0) break; // –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞ –µ—Å–ª–∏ true
		}
	}

	$random_user_name = mb_convert_case($random_user_name, MB_CASE_TITLE_SIMPLE); // –º–µ–Ω—è–µ–º —Ä–µ–≥–∏—Å—Ç—Ä
	$random_user_short_name = getShortName($random_user_name); // —Å–æ–∫—Ä–∞—â–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–º—è –∏–∑ –º–∞—Å—Å–∏–≤–∞
	$current_user_short_name = getShortName($current_user_name); // —Å–æ–∫—Ä–∞—â–∞–µ–º —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∏–º—è
	// –ø–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 50 –¥–æ 100, —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –¥–æ —Å–æ—Ç—ã—Ö 
	$random_percent = round(rand(5000, 10000) / 100, 2);
	// –≤—ã–≤–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–∫–æ–º –≤–∏–¥–µ
	$info = <<<text
		üë´ {$current_user_short_name} + {$random_user_short_name} üíè =
		üíñ –ò–¥–µ–∞–ª—å–Ω–æ –Ω–∞ {$random_percent}% üíñ 
		text;

	return $info; // —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É
}
